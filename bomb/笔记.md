# 工具的使用

## GDB

是一个gnu的调试器，可以用来一行一行的追踪程序、检查内存和寄存器、既可以看源码也可以看汇编代码、设置断点、设置内存查看点、写脚本。



## objdump -t

可以输出代码的符号表



## objdump -d

可以将程序反汇编，虽然这个指令可以提供很多信息，但是它不会告诉你故事的全部内容，有关于系统调用的反汇编展示出来的信息是神秘的。





# 解题思路

## bomb1

1、使用gdb反汇编phase_1，可以看到关键信息

![image-20230111222252901](https://gitee.com/wang-junshen/csapp/raw/master/bomb/%E7%AC%94%E8%AE%B0.assets/image-20230111222252901.png)

首先，将栈指针减8字节，开辟出一段栈空间（另作他用？），然后将立即数 0x402400 存入到寄存器 %esi，这个寄存器是用于存放第二个参数的，也就是说立即数 0x402400是接下来调用函数的第二个参数，再接着，调用strings_not_equal函数，顾名思义，此函数是用来判断两个字符串是否相等的，那么在这里，我们可以猜测输入的是一个字符串。

接下来，我们将进入strings_not_equal函数，寻找其他线索。



2、strings_not_equal函数反汇编代码：

![image-20230111224323115](https://gitee.com/wang-junshen/csapp/raw/master/bomb/%E7%AC%94%E8%AE%B0.assets/image-20230111224323115.png)

![image-20230111224344954](https://gitee.com/wang-junshen/csapp/raw/master/bomb/%E7%AC%94%E8%AE%B0.assets/image-20230111224344954.png)

可以看到，这个函数的汇编代码很多，但是先别慌，我们慢慢来分析。首先，上来先push了一系列寄存器，这是为了保存调用此函数之前寄存器的状态，因为这些寄存器有可能被修改。然后，将两个传参使用的寄存器%rdi和%rsi也保存到两个专用的寄存器中，再接着进入了string_length函数中。



3、string_length函数反汇编代码：

![image-20230111224511021](https://gitee.com/wang-junshen/csapp/raw/master/bomb/%E7%AC%94%E8%AE%B0.assets/image-20230111224511021.png)

进入此函数时，%rdi寄存器的值没有被修改，所以此处存放的还是一开始phase_1调用strings_not_equal传入的第一个参数。那么开始执行这个函数，首先，比较0和***内存地址%rdi处一个字节的值***，如果相等则跳转到倒数第二行代码，否则继续执行。由此可以看出，%rdi存储的是一个地址值，并且是一个字符串（字符数组）的起始地址，这个函数所做的行为就是计算字符串的长度，比较每一个字符是否为0，8-14为循环代码，14-16为比较判断代码。



解析完了string_length函数，我们回到strings_not_equal函数继续执行：

![image-20230111234321334](https://gitee.com/wang-junshen/csapp/raw/master/bomb/%E7%AC%94%E8%AE%B0.assets/image-20230111234321334.png)

可以看到，接下来做的操作是将结果保存到%r12d寄存器中，然后将%rbp（即%rsi）的值赋值给%rdi，接着再次调用string_length函数。这说明了什么？显然，说明了第二个参数也是一个内存地址，且是字符串的起始地址，而追溯其由来，是phase1中传递给%rsi寄存器的0x402400。

![image-20230111234648990](https://gitee.com/wang-junshen/csapp/raw/master/bomb/%E7%AC%94%E8%AE%B0.assets/image-20230111234648990.png)

说明了在这个内存地址处，存放着一个字符串，这个字符串就是第一个炸弹的钥匙。



4、分析到此处，我们已经知道了最关键的信息，答案就在内存地址0x402400处，那么我们怎么要得到这个答案呢？当然做法有很多种，这里我使用了gdb 指令 x/s：

![image-20230111235049433](https://gitee.com/wang-junshen/csapp/raw/master/bomb/%E7%AC%94%E8%AE%B0.assets/image-20230111235049433.png)

这条指令的作用是将内存地址0x402400处的内容以字符串形式打印出来。于是我们就得到了第一个模块的答案。
